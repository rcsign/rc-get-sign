@page "/"
@inject NavigationManager NavigationManager

<PageTitle>Home</PageTitle>

<NavLink class="nav-link" @onclick="LoginWithInstagram">Login</NavLink>

@code {
    protected override async Task OnInitializedAsync()
    {
        var uri = NavigationManager.ToAbsoluteUri(NavigationManager.Uri);
        var query = System.Web.HttpUtility.ParseQueryString(uri.Query);
        var code = query["?code"];

        if (!string.IsNullOrEmpty(code))
        {
            NavigationManager.NavigateTo($"/auth?code={code}", false);
        }
    }

    private void LoginWithInstagram()
    {
        var clientId = "440417048755047";
        var redirectUri = "https://rcsign.github.io";
        var authorizationUrl = $"https://api.instagram.com/oauth/authorize?client_id={clientId}&redirect_uri={redirectUri}&scope=user_profile,user_media&response_type=code";

        NavigationManager.NavigateTo(authorizationUrl, true);
    }
}
